name: Print Changelog

on:
  release:
    types: [published]

jobs:
  print-changelog:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Get previous release tag
        id: get-previous-tag
        run: |
          # Get the current release tag from the context
          current_tag=${{ github.event.release.tag_name }}
          # Use Git API to get the previous tag (assuming tags are sorted by version)
          previous_tag=$(git tag --sort version:refname | grep -P "^(?=.*$current_tag)" -Po "(?<=^v).*?(?=$)")
          # Print the previous tag or message if not found
          echo "Previous release tag: $previous_tag"
          echo "::set-output name=previous_tag::$previous_tag"

      - name: Print changelog
        uses: metcalfc/changelog-generator@v4.3.1
        with:
          myToken: ${{ secrets.GITHUB_TOKEN }}
          head-ref: ${{ github.sha }}
          base-ref: ${{ steps.get-previous-tag.outputs.previous_tag }}
          format: markdown  # Adjust format (optional)
